# 開発ロードマップ

## プロジェクト概要

- **期間**: 4-6週間
- **目標**: iPhone（PWA）で使える、GitHubと連携したMarkdown執筆アプリのMVP完成
- **対象**: 小規模リポジトリ（~50ファイル）

-----

## フェーズ1: MVP（4-6週間）

### Week 1-2: 基盤構築 + 認証

#### タスク一覧

**1. プロジェクトセットアップ**
- [ ] Vite + React + TypeScriptでプロジェクト作成
- [ ] 必要なパッケージのインストール
  - `@uiw/react-codemirror` `@codemirror/lang-markdown`
  - `octokit` `dexie` `marked`
  - `tailwindcss` `@tailwindcss/typography`
  - `zustand`
- [ ] Tailwind CSSの設定
- [ ] ディレクトリ構造の作成
- [ ] ESLint/Prettierの設定

**2. 認証機能（Personal Access Token）**
- [ ] ログイン画面のUI作成
- [ ] PAT入力フォーム
- [ ] トークン検証（GitHub API）
- [ ] LocalStorageへのトークン保存
- [ ] 認証状態管理（Zustand）
- [ ] ログアウト機能

**3. 基本レイアウト**
- [ ] アプリ全体のレイアウトコンポーネント
- [ ] ヘッダー、ナビゲーション
- [ ] ルーティング設定（React Router）

**成果物**
- ログイン機能が動作するプロトタイプ
- GitHub APIに接続できることを確認

-----

### Week 3: リポジトリ管理 + データ層

#### タスク一覧

**1. IndexedDB設計・実装（Dexie）**
- [ ] データベーススキーマ定義
  - `repositories` テーブル
  - `files` テーブル
- [ ] CRUD操作の実装
- [ ] データマイグレーション対応

**2. GitHubサービス実装**
- [ ] Octokitクライアントの初期化
- [ ] リポジトリ一覧取得API
- [ ] リポジトリ選択時の全ファイル取得
- [ ] IndexedDBへの保存

**3. ホーム画面（リポジトリ一覧）**
- [ ] リポジトリ一覧表示（カード形式）
- [ ] 検索・フィルタ機能
- [ ] 同期状態のバッジ表示
- [ ] リポジトリ選択 → ファイル一覧への遷移

**4. 状態管理（Zustand）**
- [ ] グローバルストアの設計
- [ ] リポジトリ状態管理
- [ ] ファイル状態管理
- [ ] 同期状態管理

**成果物**
- リポジトリ一覧が表示される
- リポジトリ選択で全ファイルがIndexedDBに保存される

-----

### Week 4: ファイル一覧 + エディタ基本機能

#### タスク一覧

**1. ファイル一覧画面**
- [ ] ディレクトリツリーコンポーネント
- [ ] フォルダの展開・折りたたみ
- [ ] ファイル検索機能
- [ ] 未Pushファイルのバッジ表示
- [ ] ファイルタップでエディタ画面へ遷移

**2. エディタ画面**
- [ ] CodeMirror 6の統合
- [ ] Markdownシンタックスハイライト
- [ ] 行番号表示
- [ ] 編集/プレビューのタブ切り替え
- [ ] Markdownプレビュー（Marked.js）

**3. ファイル読み込み・保存**
- [ ] IndexedDBからファイル読み込み
- [ ] 編集内容の自動保存（30秒ごと）
- [ ] `isDirty`フラグの管理
- [ ] 保存状態インジケーター

**成果物**
- ファイルツリーが表示される
- ファイルを開いてMarkdownを編集できる
- 変更がIndexedDBに保存される

-----

### Week 5: ファイル操作 + 同期機能

#### タスク一覧

**1. ファイル操作**
- [ ] 新規ファイル作成
  - パス入力ダイアログ
  - GitHub APIでファイル作成
  - IndexedDBに追加
- [ ] ファイル名変更
  - コンテキストメニュー
  - GitHub APIで更新
- [ ] ファイル削除
  - 確認ダイアログ
  - GitHub APIで削除
  - IndexedDBから削除

**2. プル機能（GitHub → ローカル）**
- [ ] プルボタンのUI
- [ ] 最新ツリー取得
- [ ] ローカルとの差分検出
- [ ] 未Pushファイルがある場合の警告
- [ ] 確認後、IndexedDB更新

**3. プッシュ機能（ローカル → GitHub）**
- [ ] 変更ファイル検出（`isDirty = true`）
- [ ] プッシュダイアログ
  - 変更ファイル一覧
  - コミットメッセージ入力
- [ ] GitHub APIで各ファイル更新
- [ ] プログレス表示
- [ ] 成功後、`isDirty`と`githubSha`を更新
- [ ] 成功/失敗の通知

**4. エラーハンドリング**
- [ ] ネットワークエラー処理
- [ ] 認証エラー（401）
- [ ] Rate Limitエラー（403）
- [ ] コンフリクト検出
- [ ] エラー通知UI

**成果物**
- ファイルの作成・編集・削除ができる
- プル・プッシュが動作する
- エラーが適切に表示される

-----

### Week 6: PWA設定 + 仕上げ

#### タスク一覧

**1. PWA設定**
- [ ] `manifest.json`作成
  - アプリ名、アイコン、テーマカラー
- [ ] アイコン生成（192x192、512x512）
- [ ] `index.html`にmanifest追加
- [ ] iOS Safariのメタタグ設定

**2. UI/UX改善**
- [ ] レスポンシブ対応（iPhone縦・横、iPad）
- [ ] ローディング状態の表示
- [ ] トースト通知の実装
- [ ] タップ領域の最適化
- [ ] アニメーション追加

**3. 設定画面**
- [ ] アカウント情報表示
- [ ] ログアウトボタン
- [ ] エディタ設定（フォントサイズ、自動保存）
- [ ] ローカルデータのクリア機能
- [ ] アプリバージョン表示

**4. テスト**
- [ ] 手動テスト（主要フロー）
  - ログイン → リポジトリ選択 → ファイル編集 → プッシュ
- [ ] iPhoneでの動作確認
- [ ] PWAインストールテスト
- [ ] オフライン編集テスト（ネット切断後、再接続してプッシュ）

**5. デプロイ**
- [ ] Vercelプロジェクト作成
- [ ] 環境変数設定（必要に応じて）
- [ ] デプロイ
- [ ] 本番環境での動作確認

**成果物**
- iPhoneのホーム画面に追加できる
- PWAとして動作する
- Vercelで公開される

-----

## タスクの依存関係

```
Week 1-2: 基盤構築
    ├─ プロジェクトセットアップ
    ├─ 認証機能 ← セットアップ完了後
    └─ 基本レイアウト ← 認証機能完了後

Week 3: データ層
    ├─ IndexedDB設計 ← 基盤構築完了後
    ├─ GitHubサービス ← 認証 + IndexedDB完了後
    └─ リポジトリ一覧画面 ← GitHubサービス完了後

Week 4: ファイル管理
    ├─ ファイル一覧画面 ← リポジトリ一覧完了後
    └─ エディタ画面 ← ファイル一覧完了後

Week 5: 同期機能
    ├─ ファイル操作 ← エディタ完了後
    └─ プル・プッシュ ← ファイル操作完了後

Week 6: 仕上げ
    ├─ PWA設定 ← 全機能完了後
    ├─ UI/UX改善 ← 並行して進める
    ├─ テスト ← 全機能完了後
    └─ デプロイ ← テスト完了後
```

-----

## 実装優先順位

### P0（必須）
- 認証（PAT）
- リポジトリ一覧・選択
- ファイル一覧表示
- ファイル編集・保存
- プッシュ機能

### P1（重要）
- ファイル作成・削除
- プル機能
- PWA設定
- エラーハンドリング

### P2（できれば）
- ファイル名変更
- 検索機能
- 設定画面
- アニメーション

-----

## フェーズ2: 使い勝手向上（2-3週間）

**スコープ：**
- Service Worker実装（完全オフライン対応）
- バックグラウンド同期
- UI/UX改善
- パフォーマンス最適化

**タスク例：**
- [ ] Service Workerの実装
- [ ] アプリキャッシュ戦略
- [ ] オフライン時のフォールバック画面
- [ ] バックグラウンド同期API
- [ ] ダークモード対応
- [ ] ファイル検索の高度化

-----

## フェーズ3: 高度な機能（将来）

**候補機能：**
- GitHub OAuth認証の追加
- 大規模リポジトリ対応（100ファイル以上）
- 画像アップロード
- テンプレート機能
- 執筆統計
- コラボレーション機能（将来）
- Claude Code統合（AIエージェント）

-----

## リスクと対策

### リスク1: GitHub API Rate Limit
- **対策**: 小規模リポジトリに限定（~50ファイル）
- **監視**: レスポンスヘッダーで残り回数を確認

### リスク2: iOS SafariのIndexedDB制限
- **対策**: 容量を定期的にチェック、警告表示
- **回避**: キャッシュクリア機能の実装

### リスク3: PWAのiOS対応
- **対策**: iOS Safari特有のメタタグ設定
- **テスト**: 実機でのこまめな動作確認

### リスク4: コンフリクト処理
- **対策**: SHA比較で検出、ユーザーに選択させる
- **UI**: わかりやすいコンフリクト解決ダイアログ

-----

## 開発時の注意事項

### コーディング規約
- TypeScript strictモード使用
- ESLint/Prettierで自動フォーマット
- コンポーネントは関数コンポーネント + Hooks

### ブランチ戦略
- `main`: 本番環境
- `develop`: 開発環境
- `feature/*`: 機能開発

### コミットメッセージ
```
feat: 新機能追加
fix: バグ修正
docs: ドキュメント更新
style: コードスタイル変更
refactor: リファクタリング
test: テスト追加
```

### レビューポイント
- モバイルでの操作性
- エラーハンドリング
- ローディング状態の表示
- データ整合性

-----

## 成果物の定義

### MVP完成の定義
- [ ] iPhoneでPWAとしてインストール可能
- [ ] GitHubリポジトリと連携できる
- [ ] Markdownファイルを編集できる
- [ ] 変更をGitHubにプッシュできる
- [ ] オフラインで編集可能（同期はオンライン時）
- [ ] Vercelで公開されている

-----

## 次のステップ

1. **Week 1開始**: プロジェクトセットアップから着手
2. **週次レビュー**: 毎週金曜日に進捗確認
3. **問題発生時**: 早めにスコープ調整

このロードマップは柔軟に調整可能です。実装中に優先順位を変更することも検討してください。
