# セキュリティ仕様

## 概要

このアプリケーションは個人用の執筆ツールとして設計されています。GitHubのPersonal Access Token（PAT）を使用して認証を行います。

## 実装されているセキュリティ対策

### 1. Content Security Policy (CSP)

**目的**: XSS攻撃の防止

**実装場所**: [index.html](../index.html)

```html
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self';
               style-src 'self' 'unsafe-inline';
               img-src 'self' data: https://avatars.githubusercontent.com;
               connect-src 'self' https://api.github.com;
               font-src 'self';
               object-src 'none';
               base-uri 'self';
               form-action 'self';">
```

**効果**:
- 外部スクリプトの実行を防止
- インラインスクリプトの実行を防止（`eval()`など）
- 信頼できるドメイン（GitHub API、GitHubアバター）のみ通信許可
- XSS攻撃によるトークン盗難のリスクを大幅に軽減

### 2. トークンの暗号化保存

**目的**: LocalStorageに保存されるトークンの保護

**実装場所**:
- [src/utils/crypto.ts](../src/utils/crypto.ts) - 暗号化ユーティリティ
- [src/services/github/auth.service.ts](../src/services/github/auth.service.ts) - 認証サービス

**暗号化方式**:
- アルゴリズム: AES-GCM
- 鍵長: 256ビット
- 鍵の生成: ブラウザフィンガープリント（UserAgent、言語、タイムゾーンなど）から決定的に生成

**効果**:
- LocalStorageを直接閲覧してもトークンが読めない
- スクリーンショットやログへの偶発的な漏洩を防ぐ
- 単純な自動スクレイパーからの保護

**制限事項**:
- **これは完全なセキュリティではありません**
- JavaScriptで復号化するため、悪意のあるスクリプトが実行されれば復号化される可能性がある
- 鍵がブラウザフィンガープリントから生成されるため、同じブラウザからは復号化可能
- CSPと組み合わせることで効果を発揮

### 3. HTTPS通信

**本番環境**: Vercelは自動的にHTTPS化されます

**効果**:
- 通信の盗聴防止
- 中間者攻撃（MITM）の防止
- トークンの通信時の漏洩防止

### 4. トークンスコープの最小化

**推奨設定**: GitHub PATのスコープは`repo`のみ

**効果**:
- 万が一トークンが漏洩しても、被害を最小限に
- リポジトリへのアクセスのみに制限
- アカウント削除などの危険な操作は不可能

## セキュリティレベル評価

### ✅ 防げる攻撃

1. **XSS攻撃（外部スクリプト注入）**
   - CSPにより外部スクリプトの実行をブロック

2. **偶発的なトークン漏洩**
   - LocalStorageの内容をスクリーンショットで共有してもトークンは暗号化済み
   - デバッグログに出力されても読めない

3. **単純な自動スクレイパー**
   - 暗号化により、自動的なトークン収集が困難

4. **通信の盗聴（本番環境）**
   - HTTPS通信により暗号化

### ⚠️ 防げない攻撃

1. **高度なXSS攻撃**
   - CSPをバイパスする攻撃手法が存在する可能性
   - `'unsafe-inline'`を許可しているCSS経由の攻撃

2. **悪意のある拡張機能**
   - ブラウザ拡張機能がLocalStorageにアクセス可能
   - 暗号化の鍵も取得できるため復号化可能

3. **物理アクセス**
   - デバイスに物理的にアクセスされた場合
   - ブラウザの開発者ツールで復号化処理を確認可能

4. **ソーシャルエンジニアリング**
   - ユーザーが騙されてトークンを渡してしまう

## 推奨される使用方法

### ✅ 安全な使い方

1. **個人専用として使用**
   - 自分のデバイスのみで使用
   - 他人にアクセスさせない

2. **信頼できる環境でホスト**
   - Vercelなどの信頼できるホスティングサービスを使用
   - 独自ドメインを使用（フィッシング対策）

3. **トークンのスコープを最小限に**
   - `repo`スコープのみを付与
   - 不要な権限は付与しない

4. **定期的なトークンの更新**
   - 3〜6ヶ月ごとにトークンを再生成
   - 古いトークンは削除

5. **ブラウザ拡張機能の管理**
   - 信頼できる拡張機能のみをインストール
   - 不要な拡張機能は削除

### ❌ 避けるべき使い方

1. **公共のPCでの使用**
   - ネットカフェ、図書館などでは使用しない
   - 他人がアクセスできる環境では使用しない

2. **信頼できないネットワークでの使用**
   - 公共Wi-Fiでの使用は避ける
   - VPNを使用することを推奨

3. **複数人での共有**
   - アカウントやデバイスを共有しない

4. **強力な権限を持つトークンの使用**
   - `admin`や`delete_repo`などのスコープは使用しない

## 今後のセキュリティ改善案

### 短期（実装容易）

1. **トークンの有効期限表示**
   - ユーザーに定期的な更新を促す
   - 古いトークンの警告

2. **ログイン履歴の表示**
   - 最終ログイン日時の記録
   - 不審なアクセスの検出

### 中期（実装やや複雑）

1. **Session Storageへの移行**
   - ブラウザを閉じたら自動ログアウト
   - セキュリティは向上するがUXは低下

2. **生体認証の追加**
   - Web Authentication API（WebAuthn）の使用
   - 指紋認証、Face IDなどに対応

### 長期（アーキテクチャ変更が必要）

1. **OAuth認証への移行**
   - GitHub OAuth Appの作成
   - バックエンドサーバーの構築
   - HttpOnly Cookieでのトークン管理
   - **最も安全だが、サーバー費用が発生**

2. **トークンプロキシサーバー**
   - トークンをサーバー側で管理
   - クライアントは一時的なセッショントークンのみ保持
   - **サーバー運用コストとメンテナンスが必要**

## まとめ

**現在の実装レベル**: 個人用アプリとして許容範囲

**適している用途**:
- ✅ 個人の執筆活動
- ✅ プライベートリポジトリの管理
- ✅ 非公開の創作活動

**適していない用途**:
- ❌ 企業での業務利用
- ❌ 複数人での共同作業
- ❌ 機密性の高いデータの管理
- ❌ 公開サービスとしての提供

**結論**: CSP + トークン暗号化により、個人用途では十分なセキュリティを確保しています。将来的に公開サービスにする場合は、OAuth認証への移行を検討してください。
